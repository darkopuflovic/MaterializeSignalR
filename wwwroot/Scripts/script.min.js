var lastSize, myAvatar, myUser, myColor, myTextColor, rootPath, myid, toId; function setUsernameAndColor(e, t, n) { myUser = e, myColor = t, myTextColor = n } function setRootPath(e) { rootPath = e } function avatarImage(e) { var t = document.getElementById("avatar-image"); if (e.target.files.length > 0 && null != t) { var n = URL.createObjectURL(e.target.files[0]); t.src = n } } function setAvatar() { var e = document.getElementById("userAvatarImage"); null != e && (e.src = myAvatar) } function setName() { document.getElementById("name").value } function setNameOnEnter(e) { 13 === e.keyCode && setName() } function setEmail() { var e = document.getElementById("email"); null != e && e.checkValidity() } function setPassword() { var e = document.getElementById("password"); null != e && e.checkValidity() } function setEmailOnEnter(e) { 13 === e.keyCode && setEmail() } function setPasswordOnEnter(e) { 13 === e.keyCode && setPassword() } function clearColors() { document.querySelectorAll(".color-palette-wrapper").forEach(function (e) { e.classList.remove("js-active") }) } function showColors(e) { clearColors(); var t = document.getElementById(e); null != t && t.classList.add("js-active") } function rgbGetValues(e) { return e.replace("rgb(", "").replace(")", "").split(",").map(function (e) { return e.trim() }) } function rgb2hex(e) { var t = e[0], n = e[1]; return "#" + (16777216 + (e[2] | n << 8 | t << 16)).toString(16).slice(1).toUpperCase() } function colorChanged(e, t) { var n = rgb2hex(rgbGetValues(e)), l = document.getElementById("userColor"), o = document.getElementById("userColorImage"), a = document.getElementById("colorHidden"), d = document.getElementById("textColorHidden"); null != l && (l.style.backgroundColor = n), null != o && (o.style.color = t), null != a && (a.value = n), null != d && (d.value = t); var r = document.querySelector("#colorPickerModal"); M.Modal.getInstance(r).close() } function addAvailableUser(e, t, n, l, o) { var a = document.getElementById("slide-out"); if (null != a) { var d = document.createElement("li"); d.setAttribute("data-id", e), d.className = "waves-effect waves-light btn li-user grey lighten-4 waves-indigo"; var r = document.createElement("div"); r.className = "row mb-0 non-selectable"; var i = document.createElement("div"); i.className = "col s3"; var s = document.createElement("img"); s.src = rootPath + "/" + n, s.className = "circle image-avatar-list"; var c = document.createElement("div"); c.className = "col s9 overflow-text-ellipsis", c.innerText = t, i.appendChild(s), r.appendChild(i), r.appendChild(c); var u = document.createElement("input"), m = document.createElement("input"); u.setAttribute("name", "color"), m.setAttribute("name", "textColor"), u.setAttribute("type", "hidden"), m.setAttribute("type", "hidden"), u.setAttribute("value", l), m.setAttribute("value", o), r.appendChild(u), r.appendChild(m), d.appendChild(r), a.appendChild(d), d.addEventListener("click", function () { document.querySelectorAll("#slide-out>.li-user").forEach(function (e) { e.classList.remove("blue"), e.classList.remove("darken-1"), e.classList.add("grey"), e.classList.add("lighten-4"), toId = null }), this.classList.remove("grey"), this.classList.remove("lighten-4"), this.classList.add("blue"), this.classList.add("darken-1"), null != (toId = this.getAttribute("data-id")) ? (document.getElementById("message").removeAttribute("disabled"), document.getElementById("sendButton").removeAttribute("disabled")) : (document.getElementById("message").setAttribute("disabled", "disabled"), document.getElementById("sendButton").setAttribute("disabled", "disabled")) }) } } function removeAvailableUser(e) { document.querySelectorAll("#slide-out>.li-user").forEach(function (t) { null != t && t.getAttribute("data-id") === e && (t.remove(), e === toId && (toId = null), null != toId ? (document.getElementById("message").removeAttribute("disabled"), document.getElementById("sendButton").removeAttribute("disabled")) : (document.getElementById("message").setAttribute("disabled", "disabled"), document.getElementById("sendButton").setAttribute("disabled", "disabled"))) }) } function addMessage(e, t, n, l, o) { var a = document.getElementById("messages-scroll"); if (null != a) var d = a.scrollTop + a.clientHeight === a.scrollHeight; var r = document.getElementById("chatMessages"), i = document.createElement("li"); i.classList.add(o), i.style.color = n, i.style.backgroundColor = t; var s = document.createElement("p"); s.innerText = l, i.appendChild(s); var c = document.createElement("small"); c.classList.add("smallClass"), c.innerText = e, i.appendChild(c), r.appendChild(i), d && null != a && a.scrollTo(0, a.scrollHeight - a.clientHeight) } NodeList.prototype.forEach = Array.prototype.forEach, document.addEventListener("DOMContentLoaded", function () { const e = (new signalR.HubConnectionBuilder).withUrl(rootPath + "/ChatHub").build(); e.on("ReceiveMessage", function (e, t) { var n = null; if (document.querySelectorAll("#slide-out>.li-user").forEach(function (t) { t.getAttribute("data-id") === e && (n = t) }), null != n) { var l = n.childNodes[0].childNodes[1].innerText, o = n.childNodes[0].childNodes[2].value, a = n.childNodes[0].childNodes[3].value; null != l && null != o && null != a && addMessage(l, o, a, t, "otherChat") } }), e.on("ClientConnected", function (e) { var t = e.id, n = e.avatar, l = e.color, o = e.textColor, a = e.userName; null != myid && null != t && myid.toUpperCase() !== t.toUpperCase() && addAvailableUser(t, a, n, l, o) }), e.on("ClientDisconnected", function (e) { removeAvailableUser(e) }), e.on("YourConnectionID", function (e) { myid = e }); var t = document.getElementById("sendButton"), n = document.getElementById("message"); null != t && t.addEventListener("click", function (t) { t.preventDefault(); const l = document.getElementById("message").value; null != l && "" !== l && null != toId && e.invoke("SendMessage", toId, myid, l).then(function () { addMessage(myUser, myColor, myTextColor, l, "myChat") }).catch(function (e) { console.error(e.toString()) }), n.value = "", M.updateTextFields() }), null != n && n.addEventListener("keyup", function (t) { if (t.preventDefault(), 13 === t.keyCode) { const t = document.getElementById("message").value; null != t && "" !== t && null != toId && e.invoke("SendMessage", toId, myid, t).then(function () { addMessage(myUser, myColor, myTextColor, t, "myChat") }).catch(function (e) { console.error(e.toString()) }), n.value = "" } }), e.start().then(function () { e.invoke("GetClients").then(function (e) { for (var t in e) if (null !== e[t] && void 0 !== e[t]) { var n = e[t].id, l = e[t].avatar, o = e[t].color, a = e[t].textColor, d = e[t].userName; myid.toUpperCase() !== n.toUpperCase() && addAvailableUser(n, d, l, o, a) } }).catch(function (e) { console.error(e.toString()) }) }).catch(function (e) { console.error(e.toString()) }) }), document.addEventListener("DOMContentLoaded", function () { var e = document.querySelectorAll(".sidenav"), t = (M.Sidenav.init(e, { edge: "left", draggable: !0 }), document.querySelectorAll(".modal")); M.Modal.init(t); document.querySelectorAll(".li-user").forEach(function (e) { e.addEventListener("mousedown", function (t) { 0 !== t.button && 1 !== t.button || (e.style.color = "white") }), e.addEventListener("mouseup", function (t) { e.style = null }) }); var n = document.getElementById("materialColor0"); null != n && (n.checked = !0) }), window.addEventListener("resize", function () { if (window.innerWidth > 992 && lastSize <= 992) { var e = document.querySelector(".sidenav"); M.Sidenav.getInstance(e).close() } lastSize = window.innerWidth; var t = document.getElementById("messages-scroll"); null != t && t.scrollTo(0, t.scrollHeight - t.clientHeight) });